<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <title>Turf.js tutorial - Kentucky hospitals</title>

    <script src='https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.css' rel='stylesheet' />
        <script src='https://api.mapbox.com/mapbox.js/plugins/turf/v3.0.11/turf.min.js'></script>
    <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>
<body>
<!--Create a mapBox map-->
<div id='map'></div>

<script>
    // Access token for MapBox
    mapboxgl.accessToken = 'pk.eyJ1IjoiZXJpY2FsZW0iLCJhIjoiY2s3NWl5dHU1MDRpZjNlb3p1NjcxMjN6diJ9.PNMEKYHGZgDm2asC-XgFlQ';

    // Create a new MapBoxGL map object
    var map = new mapboxgl.Map({
        container: 'map', // container id
        style: 'mapbox://styles/mapbox/light-v10', // stylesheet location
        center: [-114.06667, 51.04999], // starting position
        zoom: 11 // starting zoom
    });

    // Create hospitals and libraries layers - GeoJSON FeatureCollections
    // Load layers onto map
    map.on('load', function() {
        map.addLayer({
            id: 'hospitals',
            type: 'symbol',
            source: {
                type: 'geojson',
                data: "https://data.calgary.ca/resource/x34e-bcjz.geojson?$where=type=='Hospital' OR type=='PHS Clinic'"
            },
            layout: {
                'icon-image': 'hospital-15',
                'icon-allow-overlap': true
            },
            paint: { }
        });
        map.addLayer({
            id: 'schools',
            type: 'symbol',
            source: {
                type: 'geojson',
                data: "https://data.calgary.ca/resource/fd9t-tdn2.geojson"
            },
            layout: {
                'icon-image': 'school-15'
            },
            paint: { }
        });

        // Add source
        map.addSource('nearest-hospital', {
            type: 'geojson',
            data: {
                type: 'FeatureCollection',
                features: [
                ]
            }
        });
    });

    // Add interactivity
    var popup = new mapboxgl.Popup();

    // Create a HOVER event handler
    map.on('mousemove', function(e) {
        var features = map.queryRenderedFeatures(e.point, { layers: ['hospitals', 'schools'] });
        if (!features.length) {
            popup.remove();
            return;
        }
        var feature = features[0];
        popup.setLngLat(feature.geometry.coordinates)
            .setHTML(feature.properties.name)
            .addTo(map);
        map.getCanvas().style.cursor = features.length ? 'pointer' : '';
    });

    // // Create a CLICK event handler - uses Turf.js library
    // map.on('click', function(e) {
    //     // Return any features from the 'schools' layer whenever the map is clicked
    //     var schoolFeatures = map.queryRenderedFeatures(e.point, { layers: ['hospitals', 'schools'] });
    //     if (!schoolFeatures.length) {
    //         return;
    //     }
    //     var schoolFeatures = schoolFeatures[0];
    //     // Using Turf.js, find the nearest hospital to library clicked
    //     var nearestHospital = turf.nearest(schoolFeatures, hospitals);
    //
    //     // If a nearest library is found
    //     if (nearestHospital !== null) {
    //         // Update the 'nearest-library' data source to include
    //         // the nearest library
    //         map.getSource('nearest-hospital').setData({
    //             type: 'FeatureCollection',
    //             features: [
    //                 nearestHospital
    //             ]
    //         });
    //         // Create a new circle layer from the 'nearest-library' data source
    //         map.addLayer({
    //             id: 'nearest-hospital',
    //             type: 'circle',
    //             source: 'nearest-hospital',
    //             paint: {
    //                 'circle-radius': 12,
    //                 'circle-color': '#d473e0'
    //             }
    //         }, 'hospitals');
    //     }
    // });

</script>
</body>
</html>